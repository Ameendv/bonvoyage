<script>
                       LocationCar:(location,cdate1,cdate2)=>{
      return new Promise(async(resolve,reject)=>{
          cars= await db.get().collection(collection.CAR_COLLECTION).find({Location:location}).toArray()
         users=await db.get().collection(collection.USER_COLLECTION).aggregate([
             {
                 $unwind:'$booking'
              },
              {$match:{'booking.status':'placed'}},
              // {
              //     $project:{booking:1}
              // }
              {
                  $match:{$or:[
                       {'$and':[{'booking.dropoffdate':{'$lte':cdate2}},{'booking.pickupdate':{'$gte':cdate1}}]},
                       {'$and':[{'booking.dropoffdate':{'$gte':cdate2}},{'booking.pickupdate':{'$lte':cdate1}}]},
                      ]}

              },
              {
                  $project:{booking:1}
              }
          ]).toArray();

          for(i in cars){
              console.log(cars[i])
            console.log(cars[i]._id)
              for(j in users){
                  console.log(users[j].booking)

                  if(cars[i]._id == users[j].booking.carid){
                      cars.splice(i,1)
                      console.log("njan lybuss",i)
                  }
              }
          }
          console.log( 'cars',cars)
          // for(i of users){
          //  let pickup=new Date(i.booking.pickupdate).setHours(0,0,0,0)
          //  let drop=new Date(i.booking.dropoffdate).setHours(0,0,0,0)
          //  let sdate1=new Date(cdate1).setHours(0,0,0,0)
          //  let sdate2=new Date(cdate2).setHours(0,0,0,0)

          // }
         console.log(users)
          resolve(cars)
      })
  }
</script>
